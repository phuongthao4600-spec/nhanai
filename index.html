<!DOCTYPE html>
<html lang="vi">
<head>
  <meta charset="UTF-8" />
  <title>Th·ªè Nh√¢n √Åi ‚Äì Phi·∫øu 3‚Äì1‚Äì1</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <style>
    * { box-sizing: border-box; }
    body {
      margin: 0;
      font-family: system-ui, -apple-system, BlinkMacSystemFont, "Segoe UI", sans-serif;
      background: linear-gradient(135deg, #ffe7f1, #ffeef9);
      color: #333;
    }
    .page {
      max-width: 1100px;
      margin: 24px auto 40px;
      background: #fff;
      border-radius: 24px;
      box-shadow: 0 12px 40px rgba(0,0,0,0.08);
      padding: 24px 24px 32px;
    }
    .header {
      display: flex;
      gap: 16px;
      align-items: center;
      margin-bottom: 12px;
    }
    .logo {
      width: 60px;
      height: 60px;
      border-radius: 50%;
      background: radial-gradient(circle at 30% 30%, #fff, #ffd3e4);
      display: flex;
      align-items: center;
      justify-content: center;
      box-shadow: 0 6px 16px rgba(0,0,0,0.12);
      flex-shrink: 0;
      overflow: hidden;
    }
    .logo img {
      width: 80%;
      height: 80%;
      object-fit: contain;
    }
    .title-block h1 {
      margin: 0;
      font-size: 28px;
      color: #e5467f;
    }
    .title-block p {
      margin: 4px 0 6px;
      font-size: 15px;
    }
    .chip {
      display: inline-flex;
      align-items: center;
      padding: 4px 10px;
      border-radius: 999px;
      background: #ffe6f0;
      color: #e5467f;
      font-size: 13px;
      font-weight: 500;
    }

    .note {
      margin-top: 12px;
      padding: 10px 14px;
      border-radius: 14px;
      border: 1px dashed #f48fb1;
      background: #fff8fb;
      font-size: 14px;
    }

    .layout {
      display: grid;
      grid-template-columns: minmax(0, 1.1fr) minmax(0, 0.9fr);
      gap: 20px;
      margin-top: 18px;
    }

    .field-label {
      font-weight: 600;
      margin-bottom: 4px;
      font-size: 14px;
    }
    .field-hint {
      font-size: 13px;
      color: #777;
      margin-bottom: 6px;
    }
    input[type="text"], select, textarea {
      width: 100%;
      padding: 9px 11px;
      border-radius: 10px;
      border: 1px solid #e0bcd0;
      font-size: 14px;
      outline: none;
      transition: border 0.2s, box-shadow 0.2s;
      font-family: inherit;
      background: #fffdfd;
    }
    input[type="text"]:focus, select:focus, textarea:focus {
      border-color: #e5467f;
      box-shadow: 0 0 0 2px rgba(229,70,127,0.15);
    }
    textarea {
      min-height: 60px;
      resize: vertical;
    }

    .card {
      border-radius: 18px;
      padding: 14px 16px;
      background: #fff6fb;
      margin-top: 10px;
      border: 1px solid #ffd6ea;
    }

    .card-title {
      font-weight: 700;
      color: #d81b60;
      margin-bottom: 6px;
    }

    .btn-row {
      display: flex;
      gap: 10px;
      margin-top: 18px;
    }
    .btn-primary {
      border: none;
      padding: 10px 20px;
      border-radius: 999px;
      background: linear-gradient(135deg, #ff5b94, #ff80ab);
      color: #fff;
      font-weight: 600;
      cursor: pointer;
      font-size: 14px;
      box-shadow: 0 6px 16px rgba(255, 64, 129, 0.35);
      transition: transform 0.1s, box-shadow 0.1s;
    }
    .btn-primary:active {
      transform: translateY(1px);
      box-shadow: 0 3px 10px rgba(255,64,129,0.35);
    }

    /* Khung Th·ªè */
    .tho-panel {
      border-radius: 18px;
      background: #fff7fb;
      border: 1px solid #ffd1e7;
      padding: 16px;
      height: 100%;
      display: flex;
      flex-direction: column;
      align-items: stretch;
    }
    .tho-top {
      display: flex;
      flex-direction: column;
      align-items: center;
      gap: 8px;
      margin-bottom: 10px;
    }
    .tho-avatar-wrap {
      width: 130px;
      height: 130px;
      border-radius: 50%;
      background: radial-gradient(circle at 30% 30%, #fff, #ffd3e4);
      display: flex;
      align-items: center;
      justify-content: center;
      position: relative;
      box-shadow: 0 8px 22px rgba(0,0,0,0.15);
      overflow: hidden;
    }
    .tho-avatar {
      width: 82%;
      height: 82%;
      object-fit: contain;
      animation: bounce 2.2s infinite;
    }
    .giay-khen {
      width: 220px;
      margin-top: 8px;
      border-radius: 16px;
      box-shadow: 0 6px 18px rgba(0,0,0,0.12);
    }
    .hidden {
      display: none;
    }
    .tho-name {
      font-weight: 700;
      color: #e91e63;
      font-size: 16px;
    }

    .chat-box {
      margin-top: 10px;
      background: #ffffff;
      border-radius: 16px;
      padding: 12px 14px;
      font-size: 14px;
      line-height: 1.5;
      min-height: 120px;
      max-height: 260px;
      overflow-y: auto;
      border: 1px solid #ffd6ea;
    }
    .msg {
      margin-bottom: 8px;
      display: flex;
      justify-content: flex-start;
    }
    .msg.me {
      justify-content: flex-end;
    }
    .bubble {
      padding: 8px 11px;
      border-radius: 14px;
      max-width: 92%;
      background: #ffe6f1;
    }
    .msg.me .bubble {
      background: #e3f2fd;
    }

    .hint-small {
      margin-top: 6px;
      font-size: 12px;
      color: #888;
    }

    @keyframes bounce {
      0%, 100% { transform: translateY(0); }
      50% { transform: translateY(-6px); }
    }

    @media (max-width: 840px) {
      .layout {
        grid-template-columns: 1fr;
      }
    }
  </style>
</head>
<body>
  <div class="page">
    <div class="header">
      <div class="logo">
        <!-- c√¥ upload tho-nhan-ai.gif v√†o repo ƒë·ªÉ hi·ªán ·ªü ƒë√¢y -->
        <img src="tho-nhan-ai.gif" alt="Th·ªè Nh√¢n √Åi" />
      </div>
      <div class="title-block">
        <h1>Th·ªè Nh√¢n √Åi</h1>
        <p>L·∫Øng nghe phi·∫øu 3‚Äì1‚Äì1 v√† g·ª≠i l·ªùi khen cho con üß°</p>
        <span class="chip">3 l·ªùi c·∫£m ∆°n ‚Äì 1 vi·ªác t·ªët ‚Äì 1 l·ªùi y√™u th∆∞∆°ng</span>
      </div>
    </div>

    <div class="note">
      üê∞ <b>Th·ªè ƒëang ·ªü ƒë√¢y ƒë·ªÉ l·∫Øng nghe c√¢u chuy·ªán Nh√¢n √Åi c·ªßa con.</b>
      Con vi·∫øt xong phi·∫øu r·ªìi b·∫•m <b>‚ÄúG·ª≠i cho Th·ªè‚Äù</b> nha!
    </div>

    <div class="layout">
      <!-- B√äN TR√ÅI: FORM H·ªåC SINH -->
      <div>
        <div>
          <div class="field-label">T√™n h·ªçc sinh</div>
          <input id="studentName" type="text" placeholder="V√≠ d·ª•: Nguy·ªÖn Th·ªã H√¢n..." />
        </div>

        <div style="margin-top: 10px;">
          <div class="field-label">L·ªõp</div>
          <select id="lopSelect">
            <option value="">-- Ch·ªçn l·ªõp --</option>
            <option>5/1</option>
            <option>5/2</option>
            <option>5/3</option>
            <option>5/4</option>
            <option>5/5</option>
            <option>5/6</option>
            <option>5/7</option>
            <option>5/8</option>
            <option>5/9</option>
            <option>5/10</option>
            <option>5/11</option>
            <option>5/12</option>
            <option>5/13</option>
            <option>5/14</option>
            <option>5/15</option>
          </select>
        </div>

        <h3 style="margin-top: 18px; margin-bottom: 4px; color: #c2185b;">
          Phi·∫øu Nh√¢n √Åi tu·∫ßn n√†y
        </h3>
        <div class="field-hint">
          Con h√£y ho√†n th√†nh 3‚Äì1‚Äì1:
          <b>3 l·ªùi c·∫£m ∆°n ‚Äì 1 vi·ªác t·ªët ‚Äì 1 l·ªùi y√™u th∆∞∆°ng</b>.
        </div>

        <!-- 3 l·ªùi c·∫£m ∆°n -->
        <div class="card">
          <div class="card-title">üå∏ Ba l·ªùi c·∫£m ∆°n</div>

          <div class="field-label">L·ªùi c·∫£m ∆°n 1</div>
          <textarea id="camon1" placeholder="Con c·∫£m ∆°n..."></textarea>

          <div class="field-label" style="margin-top: 8px;">L·ªùi c·∫£m ∆°n 2</div>
          <textarea id="camon2" placeholder="Con c·∫£m ∆°n..."></textarea>

          <div class="field-label" style="margin-top: 8px;">L·ªùi c·∫£m ∆°n 3</div>
          <textarea id="camon3" placeholder="Con c·∫£m ∆°n..."></textarea>
        </div>

        <!-- 1 vi·ªác t·ªët -->
        <div class="card">
          <div class="card-title">üå± M·ªôt vi·ªác t·ªët con ƒë√£ l√†m</div>
          <textarea id="viectot" placeholder="Con ƒë√£ gi√∫p... ho·∫∑c ƒë√£ l√†m vi·ªác t·ªët g√¨..."></textarea>
        </div>

        <!-- 1 l·ªùi y√™u th∆∞∆°ng -->
        <div class="card">
          <div class="card-title">üíå M·ªôt l·ªùi y√™u th∆∞∆°ng</div>
          <textarea id="yeuthuong" placeholder="Con mu·ªën g·ª≠i l·ªùi y√™u th∆∞∆°ng t·ªõi..."></textarea>
        </div>

        <div class="btn-row">
          <button id="sendBtn" class="btn-primary">G·ª≠i cho Th·ªè üê∞</button>
        </div>
        <div class="hint-small">
          G·ª£i √Ω t·ª´ kh√≥a: c·∫£m ∆°n, gi√∫p ƒë·ª°, xin l·ªói, th∆∞∆°ng, y√™u, chia s·∫ª, an ·ªßi,...
        </div>
      </div>

      <!-- B√äN PH·∫¢I: TH·ªé NH√ÇN √ÅI + GI·∫§Y KHEN -->
      <div class="tho-panel">
        <div class="tho-top">
          <div class="tho-avatar-wrap">
            <img src="tho-nhan-ai.gif" alt="Th·ªè Nh√¢n √Åi" class="tho-avatar" />
          </div>
          <div class="tho-name">Th·ªè Nh√¢n √Åi ƒëang l·∫Øng nghe...</div>

          <!-- Gi·∫•y khen ‚Äì l√∫c ƒë·∫ßu ·∫©n -->
          <!-- C√¥ upload file giay-khen.png v√†o repo ƒë·ªÉ h√¨nh hi·ªán -->
          <img id="giayKhen" src="giay-khen.png" alt="Gi·∫•y khen Nh√¢n √Åi"
               class="giay-khen hidden" />
        </div>

        <div id="chatBox" class="chat-box">
          <!-- L·ªùi Th·ªè s·∫Ω hi·ªán ·ªü ƒë√¢y -->
        </div>
      </div>
    </div>
  </div>

  <script>
    // ==== LINK APPS SCRIPT C·ª¶A C√î ====
    const WEB_APP_URL =
      "https://script.google.com/macros/s/AKfycbwPwGNKdT0r0LcmBZKuL3LBBhZPbQSej82JhPDOyhyj0n7DivVuOXVEthYd9tDd7yvfQg/exec";

    const nameInput      = document.getElementById("studentName");
    const lopSelect      = document.getElementById("lopSelect");
    const camon1Input    = document.getElementById("camon1");
    const camon2Input    = document.getElementById("camon2");
    const camon3Input    = document.getElementById("camon3");
    const viectotInput   = document.getElementById("viectot");
    const yeuthuongInput = document.getElementById("yeuthuong");
    const sendBtn        = document.getElementById("sendBtn");
    const chatBox        = document.getElementById("chatBox");
    const giaykhenEl     = document.getElementById("giayKhen");

    function scrollToBottom() {
      chatBox.scrollTop = chatBox.scrollHeight;
    }

    function addMessage(html, from = "bot") {
      const msg = document.createElement("div");
      msg.className = "msg " + (from === "me" ? "me" : "bot");
      const bubble = document.createElement("div");
      bubble.className = "bubble";
      bubble.innerHTML = html;
      msg.appendChild(bubble);
      chatBox.appendChild(msg);
      scrollToBottom();
    }

    // L·ªùi ch√†o ban ƒë·∫ßu
    addMessage(
      "Ch√†o con üëã. Con h√£y ghi t√™n, ch·ªçn l·ªõp v√† ho√†n th√†nh 3 l·ªùi c·∫£m ∆°n ‚Äì 1 vi·ªác t·ªët ‚Äì 1 l·ªùi y√™u th∆∞∆°ng. " +
      "Vi·∫øt xong b·∫•m <b>‚ÄúG·ª≠i cho Th·ªè‚Äù</b>, Th·ªè s·∫Ω ƒë·ªçc v√† n√≥i v·ªõi con nh√©. üå∑"
    );

    sendBtn.addEventListener("click", () => {
      const name      = nameInput.value.trim();
      const lop       = lopSelect.value.trim();
      const camon1    = camon1Input.value.trim();
      const camon2    = camon2Input.value.trim();
      const camon3    = camon3Input.value.trim();
      const viectot   = viectotInput.value.trim();
      const yeuthuong = yeuthuongInput.value.trim();

      if (!name || !lop) {
        alert("Con nh·ªõ ghi T√äN v√† ch·ªçn L·ªöP tr∆∞·ªõc nh√©!");
        return;
      }

      // Ki·ªÉm tra xem con ƒë√£ ƒëi·ªÅn ƒë∆∞·ª£c bao nhi√™u m·ª•c trong 3-1-1
      const fields = [camon1, camon2, camon3, viectot, yeuthuong];
      const filledCount = fields.filter(t => t && t.trim() !== "").length;
      const duBai = (filledCount === 5);   // ƒë·ªß 3 c·∫£m ∆°n, 1 vi·ªác t·ªët, 1 l·ªùi y√™u th∆∞∆°ng

      let replyText = "";

      if (duBai) {
        // ƒê√£ l√†m ƒë·ªß ‚áí hi·ªán gi·∫•y khen + l·ªùi khen
        replyText =
          `Th·ªè c·∫£m ∆°n <b>${name}</b> l·ªõp <b>${lop}</b> v√¨ con ƒë√£ ho√†n th√†nh ƒë·ªß ` +
          `<b>3 l·ªùi c·∫£m ∆°n ‚Äì 1 vi·ªác t·ªët ‚Äì 1 l·ªùi y√™u th∆∞∆°ng</b> tu·∫ßn n√†y r·ªìi nha. üå∏ ` +
          `Nh·ªØng ng∆∞·ªùi nh·∫≠n l·ªùi c·∫£m ∆°n v√† y√™u th∆∞∆°ng c·ªßa con ch·∫Øc ch·∫Øn s·∫Ω r·∫•t h·∫°nh ph√∫c. ` +
          `Th·ªè t·∫∑ng con m·ªôt <b>GI·∫§Y KHEN NH√ÇN √ÅI</b> th·∫≠t ƒë·∫∑c bi·ªát. Ti·∫øp t·ª•c ph√°t huy nh√©! üíñ`;

        giaykhenEl.classList.remove("hidden");
      } else {
        // Ch∆∞a ƒë·ªß ‚áí ·∫©n gi·∫•y khen + ƒë·ªông vi√™n
        replyText =
          `Th·ªè c·∫£m ∆°n <b>${name}</b> v√¨ con ƒë√£ b·∫Øt ƒë·∫ßu vi·∫øt phi·∫øu Nh√¢n √Åi r·ªìi nha. üê∞ ` +
          `Tu·∫ßn n√†y con m·ªõi ho√†n th√†nh ƒë∆∞·ª£c <b>${filledCount}/5</b> m·ª•c. ` +
          `Tu·∫ßn sau con th·ª≠ ho√†n th√†nh ƒë·ªß 3 l·ªùi c·∫£m ∆°n ‚Äì 1 vi·ªác t·ªët ‚Äì 1 l·ªùi y√™u th∆∞∆°ng, ` +
          `Th·ªè tin con s·∫Ω l√†m ƒë∆∞·ª£c v√† s·∫Ω nh·∫≠n gi·∫•y khen Nh√¢n √Åi ƒë·∫∑c bi·ªát h∆°n n·ªØa! üí™`;

        giaykhenEl.classList.add("hidden");
      }

      addMessage(replyText, "bot");

      // Th·ªè ƒë·ªçc l·ªùi nh·∫Øn ‚Äì gi·ªçng n·ªØ ti·∫øng Vi·ªát
      const utter = new SpeechSynthesisUtterance(
        replyText.replace(/<[^>]+>/g, "") // b·ªè th·∫ª HTML khi ƒë·ªçc
      );
      utter.lang = "vi-VN";
      utter.rate = 1;
      utter.pitch = 1;
      speechSynthesis.cancel();
      speechSynthesis.speak(utter);

      // G·ª≠i d·ªØ li·ªáu l√™n Apps Script + ƒë√°nh d·∫•u X khi ƒë·ªß b√†i
      fetch(WEB_APP_URL, {
        method: "POST",
        headers: {
          "Content-Type": "application/json"
        },
        body: JSON.stringify({
          name,
          lop,
          camon1,
          camon2,
          camon3,
          viectot,
          yeuthuong,
          giaykhen: duBai ? "x" : ""
        })
      }).catch(err => {
        console.error("L·ªói g·ª≠i d·ªØ li·ªáu:", err);
      });
    });
  </script>
</body>
</html>
